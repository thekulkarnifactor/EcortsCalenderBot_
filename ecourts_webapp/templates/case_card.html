<div class="col-xl-4 col-lg-6 mb-4">
    <div class="card case-card h-100 {{ 'border-warning' if case.is_changed else 'border-light' }}" data-cino="{{ case.cino }}" data-changed="{{ case.is_changed|lower }}">

        {% if case.is_changed %}
        <div class="card-header bg-warning bg-opacity-10 border-warning">
            <div class="d-flex justify-content-between align-items-center">
                <small class="text-warning fw-bold">
                    <i class="fas fa-exclamation-circle me-1"></i>CHANGED
                </small>
                <button class="btn btn-sm btn-outline-warning" onclick="toggleChanges('{{ case.cino }}')">
                    <i class="fas fa-eye"></i>
                </button>
            </div>
        </div>
        {% endif %}

        <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-2">
                <h6 class="card-title mb-0">{{ case.case_no or 'N/A' }}</h6>
                <small class="text-muted">{{ case.type_name or 'N/A' }}</small>
            </div>

            <div class="case-parties mb-3">
                <div class="row">
                    <div class="col-6">
                        <small class="text-muted d-block">Petitioner</small>
                        <div class="fw-medium small">{{ case.petparty_name or 'N/A' }}</div>
                    </div>
                    <div class="col-6">
                        <small class="text-muted d-block">Respondent</small>
                        <div class="fw-medium small">{{ case.resparty_name or 'N/A' }}</div>
                    </div>
                </div>
            </div>

            <div class="case-details mb-3">
                <div class="row small">
                    <div class="col-12 mb-1">
                        <i class="fas fa-calendar-alt text-primary me-1"></i>
                        <strong>Next Date:</strong> {{ case.date_next_list or 'Not set' }}
                    </div>
                    <div class="col-12 mb-1">
                        <i class="fas fa-building text-info me-1"></i> {{ case.establishment_name or 'N/A' }}
                    </div>
                    <div class="col-12">
                        <i class="fas fa-gavel text-secondary me-1"></i> {{ case.purpose_name or 'N/A' }}
                    </div>
                </div>
            </div>

            {% if case.is_changed and case.change_summary %}
            <div class="change-summary mb-3 p-2 bg-warning bg-opacity-10 rounded small" id="changes-{{ case.cino }}" style="display: none;">
                <strong class="text-warning">Recent Changes:</strong><br> {% set changes = case.change_summary.replace('[', '').replace(']', '').replace('"', '').split(',') %} {% for change in changes %}
                <span class="d-block">â€¢ {{ change.strip() }}</span> {% endfor %}
            </div>
            {% endif %}

            <div class="notes-section">
                <label class="form-label small fw-medium">Your Notes:</label>
                <textarea class="form-control notes-input small" rows="2" placeholder="Add your notes for this case..." onchange="markCaseModified('{{ case.cino }}')">{{ case.user_notes or '' }}</textarea>
            </div>
        </div>

        <div class="card-footer bg-transparent">
            <div class="d-flex gap-2">
                <button class="btn btn-outline-primary btn-sm flex-fill" onclick="openCaseDetail('{{ case.cino }}')">
                    <i class="fas fa-edit me-1"></i>Edit Details
                </button>
                <button class="btn btn-success btn-sm" onclick="saveCase('{{ case.cino }}')">
                    <i class="fas fa-save"></i>
                </button> {% if case.is_changed %}
                <button class="btn btn-outline-secondary btn-sm" onclick="markReviewed('{{ case.cino }}')">
                    <i class="fas fa-check"></i>
                </button> {% endif %}
            </div>
        </div>
    </div>
</div>